(function(){var e=Handlebars.template,t=Handlebars.templates=Handlebars.templates||{};t.header=e(function(e,t,n,r,i){return n=n||e.helpers,"<h1>\n  <i class=icon-leaf></i>\n  Oregano\n</h1>\n<h2>A pinch at a time.</h2>\n<div id=new-url></div>\n"})})(),function(){var e=Handlebars.template,t=Handlebars.templates=Handlebars.templates||{};t.new_url=e(function(e,t,n,r,i){return n=n||e.helpers,'<form>\n  <input id=new-url-input type=url name=url\n      placeholder="type a url, then press enter" autofocus></input>\n</form>\n'})}(),function(){var e=Handlebars.template,t=Handlebars.templates=Handlebars.templates||{};t.url=e(function(e,t,n,r,i){function c(e,t){var r="",i,s;return r+="\n      ",s=n.title,s?i=s.call(e,{hash:{}}):(i=e.title,i=typeof i===a?i():i),r+=f(i)+"\n    ",r}function h(e,t){var r="",i,s;return r+="\n      ",s=n.url,s?i=s.call(e,{hash:{}}):(i=e.url,i=typeof i===a?i():i),r+=f(i)+"\n    ",r}n=n||e.helpers;var s="",o,u,a="function",f=this.escapeExpression,l=this;s+="<article id=url-",u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+' class="',u=n.classNames,u?o=u.call(t,{hash:{}}):(o=t.classNames,o=typeof o===a?o():o),s+=f(o)+'">\n  <h1>\n    ',o=t.title,o=n["if"].call(t,o,{hash:{},inverse:l.program(3,h,i),fn:l.program(1,c,i)});if(o||o===0)s+=o;return s+='\n  </h1>\n  <div class=controls>\n    <a href="#urls/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'/view" class=view>\n      <i class=icon-external-link></i>\n    </a>\n    <a href="#urls/',u=n.id,u?o=u.call(t,{hash:{}}):(o=t.id,o=typeof o===a?o():o),s+=f(o)+'/pinch" class=pinch>\n      <i class=icon-leaf></i>\n    </a>\n  </div>\n</article>\n',s})}(),function(){var e=function(t){if(!(this instanceof e))return new e(t);this._0=t},t=function(e){if(!(this instanceof t))return new t(e);this._0=e},n=function(e){if(!(this instanceof n))return new n(e);this._0=e},r={},i=function(e){return e()},s=new Bacon.Bus,o="body > header",u="#new-url",a="#new-url-input",f=u+" form",l="#urls",c=function(e){return'a[href="#urls/'+e+'/view"]'},h=function(e){return'a[href="#urls/'+e+'/pinch"]'},p={"return":function(e){return $.when(e)},bind:function(e,t){var n=$.Deferred();return e.done(function(e){return t(e).done(n.resolve)}),n.promise()}},d=function(){return document.location.hash.substr(1)},v=function(){return $(document).ready(function(){var e=$(o);return e.html(Handlebars.templates.header())})},m=function(){return $(document).ready(function(){var t=$(u);t.html(Handlebars.templates.new_url());var n=$(a);n.focus();var r=$(f),i=r.asEventStream("submit");return s.plug(i.map(function(t){return t.preventDefault(),e(r.serializeObject())}))})},g=function(e){return $(document).ready(function(){return e.map(y)})},y=function(e){return $(document).ready(function(){var r=$(l),i=$(Handlebars.templates.url(e));i.hide(),r.prepend(i),i.fadeIn();var o=$(c(e.id)),u=o.asEventStream("click");s.plug(u.map(function(t){return t.preventDefault(),n(e)}));var a=$(h(e.id)),f=a.asEventStream("click");return s.plug(f.map(function(n){return n.preventDefault(),t(e)}))})};s.onValue(function(r){return function(){if(r instanceof e){var s=r._0;return i(function(){return $(f)[0].reset(),function(){var e=p;return e.bind($.post("/urls",function(e,t){var n={},r;for(r in e)n[r]=e[r];for(r in t)n[r]=t[r];return n}(s,{key:d()})),function(t){return e.bind(p.return(y(t)),function(n){return e.return($("#url-"+t.id).addClass("url"))})})}()})}if(r instanceof n){var s=r._0;return i(function(){var e="/urls/"+s.id+"/view";return $.post(e,function(e,t){var n={},r;for(r in e)n[r]=e[r];for(r in t)n[r]=t[r];return n}(s,{key:d()})),$("#url-"+s.id).addClass("views"),window.open(s.url)})}if(r instanceof t){var s=r._0;return i(function(){var e="/urls/"+s.id+"/pinch";return $.post(e,function(e,t){var n={},r;for(r in e)n[r]=e[r];for(r in t)n[r]=t[r];return n}(s,{key:d()})),$("#url-"+s.id).addClass("pinches")})}}()}),v(),m(),function(){var e=p;return e.bind($.get("/urls",{key:d()}),function(t){return e.return(g(t.map(function(e){return function(e,t){var n={},r;for(r in e)n[r]=e[r];for(r in t)n[r]=t[r];return n}(e,{classNames:e.relTypes.concat(["url"]).join(" ")})})))})}()}();